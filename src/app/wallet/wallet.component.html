<!-- 
  Modern Wallet Page Template using Tailwind CSS
  This template provides a clean, responsive, and user-friendly interface for managing wallet funds.
-->
<div class="bg-gray-50 min-h-screen">
  <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    
    <header class="mb-8">
      <h1 class="text-3xl font-bold tracking-tight text-gray-900">My Wallet</h1>
      <p class="mt-1 text-sm text-gray-500">View your balances and manage your funds.</p>
    </header>

    <!-- Loading State: Skeleton UI -->
    <div *ngIf="isLoading" class="animate-pulse space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="h-40 bg-gray-200 rounded-xl"></div>
        <div class="h-40 bg-gray-200 rounded-xl"></div>
      </div>
      <div class="h-64 bg-gray-200 rounded-xl"></div>
    </div>

    <!-- Wallet Content -->
    <div *ngIf="!isLoading && (wallet$ | async) as wallet" class="space-y-6">
      
      <!-- Balance Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Withdrawable Balance -->
        <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl p-6">
          <p class="text-sm font-medium text-gray-500">Withdrawable Balance</p>
          <p class="mt-2 text-4xl font-bold tracking-tight text-green-600">{{ wallet.withdrawableBalance | currency:'INR' }}</p>
          <p class="text-xs text-gray-400 mt-1">Funds from completed rentals, ready for withdrawal.</p>
          <button (click)="openWithdrawalModal()" class="mt-4 inline-flex items-center rounded-md bg-green-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600">
            Request Withdrawal
          </button>
        </div>
        <!-- Pending Balance -->
        <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl p-6">
          <p class="text-sm font-medium text-gray-500">Pending Balance (Escrow)</p>
          <p class="mt-2 text-4xl font-bold tracking-tight text-yellow-600">{{ wallet.pendingBalance | currency:'INR' }}</p>
          <p class="text-xs text-gray-400 mt-1">Funds from ongoing rentals, held securely until completion.</p>
        </div>
      </div>

      <!-- Recent Transactions -->
      <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl">
        <h3 class="text-lg font-semibold text-gray-800 p-6 border-b border-gray-200">Recent Transactions</h3>
        <div *ngIf="wallet.recentTransactions.length === 0" class="p-6 text-center text-gray-500">
          No recent transactions found.
        </div>
        <ul *ngIf="wallet.recentTransactions.length > 0" class="divide-y divide-gray-200">
          <li *ngFor="let tx of wallet.recentTransactions" class="flex items-center justify-between p-4 hover:bg-gray-50">
            <div>
              <p class="font-medium text-gray-900">{{ tx.type }} <span *ngIf="tx.relatedBookingId">(Booking #{{ tx.relatedBookingId }})</span></p>
              <p class="text-sm text-gray-500">{{ tx.timestamp | date:'medium' }}</p>
            </div>
            <p class="text-lg font-semibold" [ngClass]="tx.amount > 0 ? 'text-green-600' : 'text-red-600'">
              {{ tx.amount | currency:'INR' }}
            </p>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Withdrawal Modal -->
<div *ngIf="isModalOpen" class="fixed inset-0 z-10 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <div class="flex items-end justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
    <!-- Background overlay -->
    <div (click)="closeModal()" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
    <!-- Modal panel -->
    <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
      <form [formGroup]="withdrawalForm" (ngSubmit)="submitWithdrawal()">
        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
          <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Request Withdrawal</h3>
          <div class="mt-4 space-y-4">
            <!-- Amount -->
            <div>
              <label for="amount" class="block text-sm font-medium text-gray-700">Amount (INR)</label>
              <input type="number" formControlName="amount" id="amount" class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm" placeholder="e.g., 500">
               <p *ngIf="withdrawalForm.get('amount')?.touched && withdrawalForm.get('amount')?.invalid" class="mt-1 text-sm text-red-600">
                Please enter a valid amount.
              </p>
            </div>
            <!-- Withdrawal Details -->
            <div>
              <label for="details" class="block text-sm font-medium text-gray-700">Withdrawal Details</label>
              <textarea formControlName="withdrawalDetails" id="details" rows="3" class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm" placeholder="Enter your UPI ID or Bank Account details here..."></textarea>
              <p *ngIf="withdrawalForm.get('withdrawalDetails')?.touched && withdrawalForm.get('withdrawalDetails')?.invalid" class="mt-1 text-sm text-red-600">
                Withdrawal details are required.
              </p>
            </div>
            <!-- Success/Error Messages -->
            <div *ngIf="successMessage" class="rounded-md bg-green-50 p-4 text-sm text-green-700">{{ successMessage }}</div>
            <div *ngIf="errorMessage" class="rounded-md bg-red-50 p-4 text-sm text-red-700">{{ errorMessage }}</div>
          </div>
        </div>
        <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
          <button type="submit" [disabled]="withdrawalForm.invalid || isSubmitting" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed">
            {{ isSubmitting ? 'Submitting...' : 'Submit Request' }}
          </button>
          <button type="button" (click)="closeModal()" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
