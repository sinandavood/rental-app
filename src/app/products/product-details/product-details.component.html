<!-- 
  Modern Product Details Page using Tailwind CSS
  This template provides a clean, responsive, and visually appealing layout for a single product.
-->
<div class="bg-gray-50 min-h-screen">
  
  <!-- Loading State: Skeleton Animation -->
  <div *ngIf="isLoading" class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 animate-pulse">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      <!-- Left Column: Image Skeleton -->
      <div class="lg:col-span-7">
        <div class="h-96 bg-gray-200 rounded-xl"></div>
        <div class="mt-4 grid grid-cols-5 gap-4">
          <div class="h-20 bg-gray-200 rounded-lg"></div>
          <div class="h-20 bg-gray-200 rounded-lg"></div>
        </div>
      </div>
      <!-- Right Column: Details Skeleton -->
      <div class="lg:col-span-5">
        <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl p-6 space-y-6">
          <div class="h-10 bg-gray-300 rounded w-1/2"></div>
          <div class="h-6 bg-gray-300 rounded w-3/4"></div>
          <div class="space-y-3">
            <div class="h-4 bg-gray-200 rounded w-5/6"></div>
            <div class="h-4 bg-gray-200 rounded w-1/2"></div>
          </div>
          <div class="h-10 bg-gray-200 rounded-full w-40"></div>
          <div class="h-40 bg-gray-200 rounded-xl"></div>
          <div class="h-12 bg-gray-300 rounded-lg w-full"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && product">
    <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- Left Column: Product Image Gallery -->
        <div class="lg:col-span-7">
          <div class="relative">
            <img [src]="'https://p2prental.runasp.net' + product.image" alt="{{ product.name }}" class="w-full h-96 object-contain bg-white rounded-xl shadow-sm ring-1 ring-gray-900/5 p-4">
            <span class="absolute top-4 left-4 inline-flex items-center rounded-full bg-yellow-100 px-3 py-1 text-sm font-medium text-yellow-800">FEATURED</span>
          </div>
          <div class="mt-4 grid grid-cols-5 gap-4">
            <div class="aspect-w-1 aspect-h-1 rounded-lg overflow-hidden ring-2 ring-blue-500">
              <img [src]="'https://p2prental.runasp.net' + product.image" alt="Thumbnail 1" class="w-full h-full object-cover">
            </div>
             <div class="aspect-w-1 aspect-h-1 rounded-lg overflow-hidden opacity-60 hover:opacity-100 cursor-pointer">
              <img [src]="'https://p2prental.runasp.net' + product.image" alt="Thumbnail 2" class="w-full h-full object-cover">
            </div>
          </div>
        </div>

        <!-- Right Column: Product Details -->
        <div class="lg:col-span-5">
          <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl p-6 space-y-6">
            <!-- Price and Title -->
            <div>
              <p class="text-4xl font-bold tracking-tight text-gray-900">{{ product.price | currency:'INR' }} <span class="text-lg font-medium text-gray-500">/ day</span></p>
              <h1 class="mt-2 text-2xl font-semibold text-gray-800">{{ product.name }}</h1>
            </div>
            
            <!-- Info Section -->
            <div class="space-y-2 text-sm text-gray-600">
              <p class="flex items-center"><i class="bi bi-geo-alt-fill mr-2 text-gray-400"></i> {{ product.location }}</p>
              <p class="flex items-center"><i class="bi bi-calendar3 mr-2 text-gray-400"></i> Posted on {{ product.createdAt | date: 'mediumDate' }}</p>
            </div>

            <!-- Availability -->
            <span class="inline-flex items-center rounded-full px-3 py-1 text-sm font-medium" [ngClass]="product.availability ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
              {{ product.availability ? 'Available for Rent' : 'Currently Unavailable' }}
            </span>

            <!-- Owner Info -->
            <div>
              <h3 class="text-sm font-medium text-gray-900">Posted By</h3>
              <div (click)="goToOwnerProducts(product.ownerId)" class="mt-2 flex items-center gap-4 bg-gray-50 p-3 rounded-lg cursor-pointer hover:bg-gray-100">
                <img [src]="profilepic ? 'https://p2prental.runasp.net' + profilepic : 'assets/constant/empty-user-profilepic.webp'" alt="{{ product.ownerName }}" class="h-12 w-12 rounded-full object-cover">
                <div>
                  <p class="font-semibold text-gray-800">{{ product.ownerName }}</p>
                  <p class="text-xs text-gray-500">Member since {{ product.createdAt | date: 'MMM yyyy' }}</p>
                </div>
              </div>
              <button (click)="chatWithOwner($event)" class="mt-3 w-full inline-flex justify-center items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                <i class="bi bi-chat-dots mr-2"></i>Chat with owner
              </button>
            </div>

            <!-- Date Picker -->
            <div class="border-t border-gray-200 pt-6">
              <h3 class="text-sm font-medium text-gray-900">Select Rental Dates</h3>
              <p class="mt-1 text-xs text-gray-500">Click a date to select the start, and a second date to select the end.</p>
              
              <!-- Selected Dates Display -->
              <div class="mt-4 grid grid-cols-2 gap-4">
                <div class="rounded-lg border border-gray-200 p-3 text-center">
                  <p class="text-xs font-medium text-gray-500">Start Date</p>
                  <p class="mt-1 font-semibold text-gray-900">{{ startDate ? (startDate | date: 'mediumDate') : 'Select start' }}</p>
                </div>
                <div class="rounded-lg border border-gray-200 p-3 text-center">
                  <p class="text-xs font-medium text-gray-500">End Date</p>
                  <p class="mt-1 font-semibold text-gray-900">{{ endDate ? (endDate | date: 'mediumDate') : 'Select end' }}</p>
                </div>
              </div>

              <!-- Angular Material Calendar -->
              <mat-calendar (selectedChange)="selectDate($event)" [selected]="selectingStart ? startDate : endDate" [dateClass]="dateClass.bind(this)" class="mt-4 w-full"></mat-calendar>

              <!-- Clear Button -->
              <div *ngIf="startDate || endDate" class="mt-2">
                <!-- Note: You'll need to add the clearDates() method to your component's .ts file. -->
                <button (click)="clearDates()" class="text-sm font-semibold text-blue-600 hover:text-blue-500">Clear Selection</button>
              </div>
            </div>


            <!-- Action Button -->
            <div class="border-t border-gray-200 pt-6">
              <button (click)="requestBooking()" [disabled]="!product.availability || hasRequested" class="w-full inline-flex justify-center items-center rounded-md bg-blue-600 px-4 py-3 text-base font-semibold text-white shadow-sm hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed">
                {{ hasRequested ? 'Request Sent' : 'Request Rental' }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Description & Similar Products -->
      <div class="mt-8 space-y-8">
        <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl p-6">
          <h2 class="text-xl font-semibold text-gray-900">Description</h2>
          <p class="mt-4 text-gray-600 leading-relaxed">{{ product.description }}</p>
        </div>

        <div *ngIf="similarProducts.length > 0">
          <h2 class="text-xl font-semibold text-gray-900">Similar Products</h2>
          <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Similar Product Card (Loop) -->
            <div *ngFor="let sim of similarProducts | slice:0:4" class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl flex flex-col">
              <img [src]="'https://p2prental.runasp.net' + sim.image" alt="{{ sim.name }}" class="rounded-t-xl w-full h-40 object-contain p-2">
              <div class="p-4 flex-grow flex flex-col">
                <h3 class="font-semibold text-gray-800 truncate">{{ sim.name }}</h3>
                <p class="text-sm text-gray-500 flex-grow"><i class="bi bi-geo-alt mr-1.5"></i>{{ sim.location }}</p>
                <div class="mt-3 flex justify-between items-center">
                  <p class="font-bold text-blue-600">{{ sim.price | currency:'INR' }}/day</p>
                  <a [routerLink]="['/products', sim.id]" class="rounded-md bg-white px-3 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">View</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
